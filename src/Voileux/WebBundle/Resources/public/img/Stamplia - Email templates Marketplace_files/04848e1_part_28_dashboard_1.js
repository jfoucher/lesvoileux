// Generated by CoffeeScript 1.4.0
(function() {

  App.View.Dashboard = App.View.Profile.extend({
    tagName: 'div',
    id: 'my-invoices',
    className: 'admin-module',
    templateName: 'dashboard',
    breadcrumbs: null,
    purchases: null,
    messages: null,
    initialize: function() {
      var _this = this;
      this.purchases = new App.Model.PurchaseCollection;
      this.purchases.fetch();
      App.user.bind('change', function() {
        return _this.displayUserData();
      });
      App.user.bind('sync', function() {
        return _this.displayUserData();
      });
      App.messages.bind('sync', function() {
        return _this.showMessages();
      });
      return App.messages.bind('reset', function() {
        return _this.showMessages();
      });
    },
    render: function() {
      var _this = this;
      $(this.el).html(this.template());
      this.$('#available-downloads').hide();
      App.setActive('dashboard');
      this.breadcrumbs = [
        {
          label: App.user.get('name'),
          link: '#dashboard'
        }
      ];
      App.setBreadcrumbs(this.breadcrumbs);
      App.start().done(function() {
        _this.profileEditForm = new App.View.EditProfileForm();
        _this.$('.userData').prepend(_this.profileEditForm.render());
        _this.$('#edit-form').hide();
        _this.showMessages();
        return App.resetHeight();
      });
      this.purchases.fetched.done(function() {
        var bghttmpl, r, view;
        if (_this.purchases.models.length) {
          _this.$('#available-downloads').show();
          r = (function() {
            var _i, _len, _ref, _results;
            _ref = this.purchases.models;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              bghttmpl = _ref[_i];
              view = new App.View.Download({
                model: bghttmpl
              });
              _results.push(view.render());
            }
            return _results;
          }).call(_this);
          r;

          _this.$('.templates-list').html(r);
          return App.resetHeight();
        }
      });
      this.showMessages();
      $('#my-info .interior, #my-messages-lite .interior').animate({
        height: 180
      }, function() {
        return App.resetHeight();
      });
      App.resetHeight();
      return this.el;
    }
  });

}).call(this);
