// Generated by CoffeeScript 1.4.0
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  App.Router = (function(_super) {

    __extends(Router, _super);

    function Router() {
      return Router.__super__.constructor.apply(this, arguments);
    }

    Router.prototype.routes = {
      "": "main",
      "splash": "main",
      "logout": "logout",
      "uploads": "uploads",
      "templates": "templates",
      "invoices": "invoices",
      "downloads": "downloads",
      "template/*cat/:slug": "template",
      "signup": "signup",
      "dashboard": "dashboard",
      "orderNow": "orderNow",
      "messages": "messages",
      "message/:id": "message",
      "profile": "profile",
      "seller": "seller"
    };

    Router.prototype.main = function() {
      if (App.beta) {
        return this.splash();
      }
    };

    Router.prototype.logout = function() {
      App.unsetPref('token');
      App.client.setToken(null);
      window.location.hash = '';
      return window.location.reload();
    };

    Router.prototype.splash = function() {
      var _this = this;
      return App.start().always(function() {
        var r, signupForm;
        if (App.user) {
          return window.location = '/backend#dashboard';
        } else {
          signupForm = new App.View.SignupForm;
          $('#signup').remove();
          r = signupForm.render();
          return $('#content').find('.ctr').append(r);
        }
      });
    };

    Router.prototype.template = function(cat, slug) {
      var template,
        _this = this;
      template = new App.Model.Template();
      template.set('slug', slug);
      return template.fetch().done(function() {
        var loves, v;
        v = new App.View.TemplateBuy({
          model: template
        });
        $('#template-buy').html(v.render());
        loves = new App.View.TemplateLoves({
          model: template
        });
        return $('#template-main').find('.loves').html(loves.render());
      });
    };

    Router.prototype.category = function(slug) {
      var category,
        _this = this;
      this.emptyTemplatesList();
      category = new App.Model.Category;
      category.set('name', slug);
      App.templates = new App.Model.TemplateCollection;
      App.templates.category = category;
      App.templates.fetch();
      App.templates.fetched.done(function() {
        return _this.showTemplates();
      });
      return category.fetch().done(function() {});
    };

    Router.prototype.emptyTemplatesList = function() {
      return $('#templates-list').html('');
    };

    Router.prototype.showTemplates = function() {
      var els, template, view;
      els = (function() {
        var _i, _len, _ref, _results;
        _ref = App.templates.models;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          template = _ref[_i];
          view = new App.View.Template({
            model: template
          });
          _results.push(view.render());
        }
        return _results;
      })();
      return $('#templates-list').html(els);
    };

    Router.prototype.uploads = function() {
      App.views.uploadView = new App.View.Upload;
      return App.setContent(App.views.uploadView.render());
    };

    Router.prototype.orderNow = function() {
      var orderView;
      orderView = new App.View.Payment;
      return App.setContent(orderView.render());
    };

    Router.prototype.signup = function() {
      var r, signupView;
      if (App.user) {
        App.router.navigate('uploads', {
          trigger: true
        });
        return;
      }
      signupView = new App.View.SignupLogin;
      r = $('<div class="admin-module" />');
      r.html(signupView.render());
      r.prepend(r.find('#signup-title'));
      App.setContent(r);
      return $('#admin-content').addClass('splash');
    };

    Router.prototype.templates = function() {
      if (!App.views.templatesView) {
        App.views.templatesView = new App.View.Templates;
      }
      return App.setContent(App.views.templatesView.render());
    };

    Router.prototype.invoices = function() {
      if (!App.views.invoicesView) {
        App.views.invoicesView = new App.View.Invoices;
      }
      return App.setContent(App.views.invoicesView.render());
    };

    Router.prototype.downloads = function() {
      if (!App.views.downloadsView) {
        App.views.downloadsView = new App.View.Downloads;
      }
      return App.setContent(App.views.downloadsView.render());
    };

    Router.prototype.dashboard = function() {
      App.views.dashboardView = new App.View.Dashboard;
      return App.setContent(App.views.dashboardView.render());
    };

    Router.prototype.seller = function() {
      if (!App.views.sellerView) {
        App.views.sellerView = new App.View.Seller;
      }
      return App.setContent(App.views.sellerView.render());
    };

    Router.prototype.messages = function() {
      App.views.messagesView = new App.View.Messages;
      return App.setContent(App.views.messagesView.render());
    };

    Router.prototype.message = function(id) {
      var messagesView;
      messagesView = new App.View.Messages({
        loadInbox: false
      });
      App.setContent(messagesView.render());
      return messagesView.showMessage(id);
    };

    Router.prototype.profile = function() {
      if (!App.views.profileView) {
        App.views.profileView = new App.View.Profile;
      }
      return App.setContent(App.views.profileView.render());
    };

    return Router;

  })(Backbone.Router);

}).call(this);
